<?php
/**
 * @var Zend\View\Renderer\PhpRenderer         $this
 * @var \Application\ResultSet\SupportedLocale $supportedLocales
 * @var \Application\ResultSet\Translation     $translations
 * @var \Application\ResultSet\TranslationBase $translationBase
 * @var \Application\ResultSet\TranslationFile $translationFiles
 * @var \Application\Model\SupportedLocale     $locale
 */
?>

<h2><?= $this->translate('Import') ?></h2>
<div class="card mt-4">
    <div class="card-header"><?php echo $this->translate('Import MAGENTO Language CSV file(s) (Dummy, not yet implemented!)') ?></div>
    <div class="card-body">

        <form action="<?php echo $this->url('admin', [ 'action' => 'import' ]) ?>" method="post" multipart="" enctype="multipart/form-data" role="form">
            <div class="form-group">
                <label class="control-label" for="filebutton"><?php echo $this->translate('Select File(s)') ?></label><br>
                <input type="file" name="files[]" id="filebutton" class="input-large" multiple>
            </div>
            <div class="form-group row">
                <div class="col-sm-12">
                    <label for="locale"><?php echo $this->translate('Import as locale') ?></label>
                </div>
                <div class="col-sm-2">
                    <select class="form-control" id="locale">
                        <?php foreach ($supportedLocales as $locale): ?>
                            <option value="<?php echo $locale->getLocale() ?>"><?php echo $locale->getLocale() ?></option>
                        <?php endforeach; ?>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <button type="submit" id="submit" name="Import" class="btn btn-info button-loading" data-loading-text="Loading..."><?php echo $this->translate('Start Import') ?></button>
            </div>
        </form>
    </div>
</div>

<?php $this->inlineScript()->captureStart(); ?>

$("document").ready(function () {
    $("#filebutton").change(function () {
        var fullPath   = $("#filebutton").val();

        if (fullPath) {
            var startIndex = (fullPath.indexOf('\\') >= 0 ? fullPath.lastIndexOf('\\') : fullPath.lastIndexOf('/'));
            var filename   = fullPath.substring(startIndex);

            if ((filename.indexOf('\\') === 0) || (filename.indexOf('/') === 0)) {
                filename = filename.substring(1);
            }

            // Remove file extension
            filename = filename.substring(0, filename.lastIndexOf(".csv"));

            // Extract locale from file name
            var tokens = filename.split('_').slice(-2);
            var locale = tokens.join('_');

            // Pre select locale
            $("#locale").val(locale);
        }
    });
});

<?php $this->inlineScript()->captureEnd(); ?>
